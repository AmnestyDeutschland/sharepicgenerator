const draw=SVG().addTo("#canvas");var info={foo:null};const bgpic={width:800,height:450,originalWidth:1920,originalHeight:1080,filename:"assets/bg_small.jpg"};function message(e=!1){e?$("#message").show().html(e):$("#message").hide()}function setDrawsize(){let e=$("#width").val(),t=$("#height").val();draw.size(e,t),$("#canvas").height(draw.height()),calculateSizes(),text.bounce(),pin.bounce(),subline.draw(),window.setTimeout(logo.draw,100)}function resetDrawsize(){$("#width").val(info.previewWidth),$("#height").val(info.previewHeight),setDrawsize()}function calculateSizes(){$("#textsize").attr("min",.2*draw.width()),$("#textsize").attr("max",draw.width()),$("#textsize").val(.5*draw.width()),$("#textX").val(0),$("#textY").val(draw.height()/2),$("#pinsize").attr("min",Math.max(50,.1*draw.width())),$("#pinsize").attr("max",Math.max(50,.25*draw.width())),$("#pinsize").val(.175*draw.width()),$("#pinX").val(draw.width()/2),$("#pinY").val(draw.height()/2),$("#backgroundsize").attr("min",draw.width()),$("#backgroundsize").attr("max",5*draw.width()),$("#backgroundsize").val(draw.width()),$("#backgroundX").val(0),$("#backgroundY").val(0)}function uploadImageByUrl(e,t=function(){}){$("#waiting").addClass("active");var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="blob",a.onload=function(){let e=new FileReader;e.onload=function(){$.post("upload.php",{data:e.result}).done(function(e){let a=JSON.parse(e);$(".overlay.active").removeClass("active"),afterUpload(a),t()})},e.readAsDataURL(a.response)},a.send()}function afterUpload(e){draw.size(e.width,e.height),info.originalWidth=e.originalWidth,info.originalHeight=e.originalHeight,info.previewWidth=draw.width(),info.previewHeight=draw.height(),background.filename=e.filename,$("#width").val(draw.width()),$("#height").val(draw.height()),setDrawsize(),background.draw(),pin.draw(),window.setTimeout(text.draw,10)}$(document).ready(function(){afterUpload(bgpic),$("#text").val("!Leben\nlassen")}),$(".close").click(function(){$(".overlay.active").removeClass("active")}),$(".size").bind("input propertychange",setDrawsize),$("#sizereset").click(resetDrawsize),$("#download").click(function(){$(this).prop("disabled",!0);let e=$(this).html();$(this).html("Augenblick bitte");let t=draw.svg();$.ajax({type:"POST",url:"createpic.php",data:{svg:t,format:"png",width:info.originalWidth},success:function(t,a,i){let n=JSON.parse(t);$("#download").prop("disabled",!1),$("#download").html(e),window.location.href="download.php?file="+n.basename+"&format=png"}})}),$("#uploadfile").change(function(e){$("#uploadfile").prop("disabled",!0),$("#upload .message").html("Lade hoch...");let t=e.target,a=new FileReader;a.onload=function(){$.post("upload.php",{data:a.result}).done(function(e){let t=JSON.parse(e);$("#uploadfile").prop("disabled",!1),$("#upload .message").html(""),afterUpload(t)})},a.readAsDataURL(t.files[0])});const background={svg:draw.circle(0),isLoaded:!1,draw(){this.svg.remove(),this.svg=draw.image(this.filename,function(e){this.back().draggable(),background.isLoaded=!0,background.resize(),background.svg.move(parseInt($("#backgroundX").val()),parseInt($("#backgroundY").val())),this.on("dragend.namespace",function(e){$("#backgroundX").val(this.x()),$("#backgroundY").val(this.y()),background.bounceWarning()})})},reset:function(){$("#backgroundX").val(0),$("#backgroundY").val(0),$("#backgroundsize").val(parseInt($("#backgroundsize").prop("min"))),this.draw(),background.bounceWarning()},resize:function(){let e=parseInt($("#backgroundsize").val());this.svg.size(e),background.bounceWarning()},bounceWarning:function(){if(!this.isLoaded)return!1;let e=!1;this.svg.x()>0&&(e=!0),this.svg.x()+this.svg.width()<draw.width()&&(e=!0),this.svg.y()>0&&(e=!0),this.svg.y()+this.svg.height()<draw.height()&&(e=!0),e?message('Im Bild entsteht ein weißer Rand. Platziere das Bild neu, <a href="#" onClick="background.reset();">setze es zurück</a> oder vergrößere es.'):message()}};$("#backgroundreset").click(function(){background.reset()}),$("#backgroundsize").bind("input propertychange",function(){background.resize()});const text={svg:draw.text(""),lineheights:[26,40],colors:["#449d2f","#255119"],fontsizes:[23,40],yBiases:[0,-3],linemargin:4,paddingLr:5,font:{family:"Arvo",anchor:"left",leading:"1.25em",weight:"bold"},draw:function(){text.svg.remove(),text.svg=draw.group().addClass("draggable").draggable(),text.svg.on("dragend.namespace",function(e){$("#textX").val(this.x()),$("#textY").val(this.y()),text.bounce()});let e=0;$("#text").val().split(/\n/).forEach(function(t,a,i){let n=/^!/.test(t)?1:0;t=t.replace(/^!/,"").toUpperCase();let s=draw.text(t).font({...text.font,...{size:text.fontsizes[n]}}).fill(text.colors[n]).move(0,e+text.yBiases[n]),r=draw.rect(s.length()+2*text.paddingLr,text.lineheights[n]).fill("white").move(-text.paddingLr,e);text.svg.add(r).add(s),e+=text.lineheights[n]+text.linemargin}),text.svg.move(parseInt($("#textX").val()),parseInt($("#textY").val())).size(parseInt($("#textsize").val()))},bounce:function(){this.svg.x()<15&&($("#textX").val(15),this.draw()),this.svg.x()>draw.width()-this.svg.width()-15&&($("#textX").val(draw.width()-this.svg.width()-15),this.draw()),this.svg.y()<30&&($("#textY").val(30),this.draw()),this.svg.y()>draw.height()-this.svg.height()-30&&($("#textY").val(draw.height()-this.svg.height()-30),this.draw())}};$("#text").bind("input propertychange",text.draw),$("#textsize").bind("input propertychange",text.draw);const logo={isLoaded:!1,svg:draw.image("assets/sonnenblume.svg",function(e){logo.isLoaded=!0}),draw(){if(!logo.isLoaded)return!1;let e=Math.max(50,.1*draw.width());logo.svg.size(e).x(draw.width()-e-10).y(10)}};var claim=draw.text("AM 15. MÄRZ GRÜN WÄHLEN.").fill("white").move(15,15);claim.font({family:"Arvo",size:15,anchor:"left",weight:700}),$("#pinsize").bind("input propertychange",function(){pin.draw()});const pin={isLoaded:!1,svg:draw.image("assets/pin.svg",function(e){pin.isLoaded=!0,this.on("dragend.namespace",function(e){$("#pinX").val(this.x()),$("#pinY").val(this.y()),pin.bounce()}),pin.draw()}).addClass("draggable").draggable(),draw(){if(!this.isLoaded)return!1;pin.svg.move(parseInt($("#pinX").val()),parseInt($("#pinY").val())),pin.svg.size(parseInt($("#pinsize").val()))},bounce:function(){if(!this.isLoaded)return!1;this.svg.x()<15&&($("#pinX").val(15),this.draw()),this.svg.x()>draw.width()-this.svg.width()-15&&($("#pinX").val(draw.width()-this.svg.width()-15),this.draw()),this.svg.y()<30&&($("#pinY").val(30),this.draw()),this.svg.y()>draw.height()-this.svg.height()-30&&($("#pinY").val(draw.height()-this.svg.height()-30),this.draw())}},subline={svg:draw.circle(0),draw(){subline.svg.remove(),subline.svg=draw.text($("#subline").val().toUpperCase()).fill("white").move(15,draw.height()-24).font({family:"Arvo",size:15,anchor:"left",weight:700})}};$("#subline").bind("input propertychange",subline.draw),$("#pixabayopener").click(function(){$("#pixabay").addClass("active")}),$("#pixabay>form").submit(function(){return getPixabayImages($("#pixabay>form>.q").val()),!1});var pixabayAPIKey="1309982-0e2df8b488eca18e61116743a",page=1;function getPixabayImages(e){let t="https://pixabay.com/api/?key="+pixabayAPIKey+"&q="+encodeURIComponent(e)+"&image_type=photo&page="+page+"&per_page=100";$.ajax({url:t,success:function(e,t,a){$("#pixabay>.results").html(""),e.hits.forEach(function(e){$("#pixabay>.results").append('<img src="'+e.previewURL+'" data-url="'+e.largeImageURL+'">')}),$("#pixabay>.results>img").click(function(){uploadImageByUrl($(this).data("url"))})}})}function build(){uploadImageByUrl("persistent/fox.jpg",function(){$("#textX").val(10),$("#textY").val(290),$("#textsize").val(211),$("#pinX").val(510),$("#pinY").val(270),$("#backgroundX").val(-500),$("#backgroundY").val(-500),$("#backgroundsize").val(1700),$("#text").val("Das ist ein\n!Fuchs"),pin.draw()})}
//# sourceMappingURL=main.min.js.map