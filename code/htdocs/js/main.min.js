var draw=SVG().addTo("#canvas").size(info.width,info.height),bgpic={width:800,height:450,originalWidth:1920,originalHeight:1080,filename:"assets/bg_small.jpg"};function redraw(){$("#textfieldresize").attr("min",draw.width()/6),$("#textfieldresize").attr("max",draw.width()),textfield.size(draw.width()/1.5).move(50,50),$("#pinresize").attr("min",draw.width()/10),$("#pinresize").attr("max",draw.width()/4),$("#pinresize").val(draw.width()/7),pin.move(draw.width()/2,draw.height()/2),$("#logoresize").attr("min",draw.width()/20),$("#logoresize").attr("max",draw.width()/5),$("#logoresize").val(draw.width()/13),image.back(),setLogoPosition(),handleSubline()}$(document).ready(function(){afterUpload(bgpic),handleSubline()}),$(".close").click(function(){$(".overlay.active").removeClass("active")}),$("#download").click(function(){$(this).prop("disabled",!0);let e=$(this).html();$(this).html("Augenblick bitte");let i=draw.svg();$.ajax({type:"POST",url:"createpic.php",data:{svg:i,format:"png",width:info.originalWidth},success:function(i,t,a){let n=JSON.parse(i);$("#download").prop("disabled",!1),$("#download").html(e),window.location.href="download.php?file="+n.basename+"&format=png"}})}),$("#uploadfile").change(function(e){$("#uploadfile").prop("disabled",!0),$("#upload .message").html("Lade hoch...");let i=e.target,t=new FileReader;t.onload=function(){$.post("upload.php",{data:t.result}).done(function(e){let i=JSON.parse(e);$("#uploadfile").prop("disabled",!1),$("#upload .message").html(""),afterUpload(i)})},t.readAsDataURL(i.files[0])});var image=draw.circle(0);function afterUpload(e){draw.size(e.width,e.height),info.originalWidth=e.originalWidth,info.originalHeight=e.originalHeight,image.remove(),image=draw.image(e.filename,function(e){image.size(draw.width(),draw.height()),setSize(draw.width(),draw.height()),redraw()})}function handleSize(){let e=$("#width").val(),i=$("#height").val();draw.height(i),draw.width(e),redraw()}function setSize(e,i){$("#width").val(e),$("#height").val(i)}$(".size").bind("input propertychange",handleSize);var logo,textfield=draw.group();function handleText(){let e=[],i=[],t=$("#text").val().split(/\n/),a=["#449d2f","#255119"],n=[20,40],l=[30,60],o=[0,-8],d=0;textfield.remove(),textfield=draw.group().addClass("draggable").draggable();for(let r=0;r<t.length;r++){let s=t[r].toUpperCase(),p=0;"!"==s.substring(0,1)&&(s=s.substring(1),p=1);let h=a[p],f=n[p],g=l[p],c=o[p];e[r]=draw.text(s).fill(h).move(5,d+c),e[r].font({family:"Arvo",size:f,anchor:"left",leading:"1.5em",weight:"bold"}),i[r]=draw.rect(e[r].length()+10,g).fill("white").move(0,d),d+=g+4,textfield.add(i[r]).add(e[r])}setPositionOfTextfield(),$("#textfieldresize").val(textfield.width())}function setPositionOfTextfield(){textfield.x(info.x),textfield.y(info.y),textfield.size(info.size),textfield.front()}function setLogoPosition(){logo.x(draw.width()-logo.width()-10).y(10)}$("#text").bind("input propertychange",handleText),handleText(),textfield.on("dragend.namespace",function(e){info.x=textfield.x(),info.y=textfield.y()}),$("#textfieldresize").bind("input propertychange",function(){let e=parseInt($(this).val());textfield.size(e),info.size=e}),logo=draw.image("assets/sonnenblume.svg",function(e){logo.size(draw.width()/13).x(draw.width()-110).y(10)}),$("#logoresize").bind("input propertychange",function(){let e=parseInt($(this).val());logo.size(e),scale=e/100,claim.transform({scale:scale,origin:"top left"}),subline.transform({scale:scale,origin:"bottom left"}),setLogoPosition()});var claim=draw.text("AM 15. MÄRZ GRÜN WÄHLEN.").fill("white").move(15,15);claim.font({family:"Arvo",size:15,anchor:"left",weight:600});var pin=draw.image("assets/pin.svg",function(e){pin.size(100).move(draw.width()/2,draw.height()/2),$("#pinresize").val(100),pin.addClass("draggable").draggable()});$("#pinresize").bind("input propertychange",function(){let e=parseInt($(this).val());pin.size(e)}),$("#subline").bind("input propertychange",handleSubline);var subline=draw.text("");function handleSubline(){subline.remove(),(subline=draw.text($("#subline").val().toUpperCase()).fill("white").move(15,draw.height()-24)).font({family:"Arvo",size:15,anchor:"left",weight:600})}$("#pixabayopener").click(function(){$("#pixabay").addClass("active")}),$("#pixabay>form").submit(function(){return getPixabayImages($("#pixabay>form>.q").val()),!1});var pixabayAPIKey="1309982-0e2df8b488eca18e61116743a",page=1;function getPixabayImages(e){let i="https://pixabay.com/api/?key="+pixabayAPIKey+"&q="+encodeURIComponent(e)+"&image_type=photo&page="+page+"&per_page=50";$.ajax({url:i,success:function(e,i,t){$("#pixabay>.results").html(""),e.hits.forEach(function(e){$("#pixabay>.results").append('<img src="'+e.previewURL+'" data-url="'+e.largeImageURL+'">')}),$("#pixabay>.results>img").click(uploadImageByUrl)}})}function uploadImageByUrl(){let e=$(this).data("url");$("#waiting").addClass("active");var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(){let e=new FileReader;e.onload=function(){$.post("upload.php",{data:e.result}).done(function(e){let i=JSON.parse(e);$(".overlay.active").removeClass("active"),afterUpload(i)})},e.readAsDataURL(i.response)},i.send()}